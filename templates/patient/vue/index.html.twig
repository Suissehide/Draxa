{% extends 'layout.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/timeline.css') }}">
{% endblock %}

{% block title %}
    Vue
    {{ patient.nom }}
{% endblock %}

{% block toolbar_component %}
    <button class="cd cd-save js-cd-save"><span class="glyphicon glyphicon-floppy-disk"></span></button>
    <a class="cd cd-back js-cd-back" href="{{ url('patient') }}"><span class="glyphicon glyphicon-chevron-left"></span></button>
{% endblock %}

{% block page_content %}
    <div class="wrapper scrollbar">
        <h1 id="top">Index |
            {{ patient.nom }}</h1>
        <div class="well nav-bar" id="navMenu">
            <div class="btn-group btn-nav">
                <a href="{{ url('patient') }}" class="btn btn-default" id="btn-back">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Retour
                </a>
                <a href="#details" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-search"></span>
                    Informations
                </a>
                <a href="#consultations" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-book"></span>
                    Consultations
                </a>
                <a href="#entretiens" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-bookmark"></span>
                    Entretiens individuels
                </a>
                <a href="#ateliers" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-scissors"></span>
                    Ateliers
                </a>
            </div>
        </div>

        <div class="content">

            {{ form_start(form) }}
            {{ form_errors(form) }}

            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.observ, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.divers, {'required': false}) }}
                </div>
            </div>
            <div class="separator">
                <span id="details" class="separator-text">Détails</span>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.sexe) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.nom) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.prenom) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.date) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.tel1) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.tel2, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.distance, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.etude, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.profession, {'required': false}) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.activite, {'required': false}) }}
                </div>
            </div>
            <div class="separator">
                <span class="separator-text">Données à l'inclusion</span>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.diagnostic, {'required': false}) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.dedate) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.orientation, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.etpdecision, {'required': false}) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.progetp, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.precisions, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.precisionsperso, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.objectif, {'required': false}) }}
                </div>
            </div>

            <div class="separator">
                <span id="fin" class="separator-text">Données à la sortie</span>
            </div>
            <div class="row">
		        <div class="col-md-3">
                    {{ form_row(form.dentree, {'required': false}) }}
                </div>
	        </div>
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.motif, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.etp, {'required': false}) }}
                </div>
            </div>

            <div class="separator">
                <span id="consultations" class="separator-text">Consultations</span>
            </div>

            <section class="cd-horizontal-timeline row" id="timeline-rendezVous">
                <div class="timeline">
                    <div class="events-wrapper">
                        <div class="events">
                            <ol id="events-rendezVous">
                                {% for rendezVousForm in form.rendezVous %}
                                    <li>
                                        <a href="#0" data-date="{{ rendezVousForm.vars.value.date|date("d/m/Y") }}" {% if loop.last %} class="selected" {% else %} class="older-event" {% endif %}>
                                            {{ rendezVousForm.vars.value.date|format_datetime(pattern="d MMM", locale='fr')  }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ol>

                            <span class="filling-line" aria-hidden="true"></span>
                        </div>
                        <!-- .events -->
                    </div>
                    <!-- .events-wrapper -->

                    <ul class="cd-timeline-navigation">
                        <li>
                            <a href="#0" class="prev inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="next">Next</a>
                        </li>
                    </ul>

                    <a class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span></a>
                    <!-- .cd-timeline-navigation -->
                </div>
                <!-- .timeline -->

                <div class="events-content">
                    <ol id="events-content-rendezVous">
                        {% for rendezVousForm in form.rendezVous %}
                            {% set counter = (counter | default(0)) + 1 %}
                            <li {% if loop.last %} class="selected" {% endif %} data-date="{{ rendezVousForm.vars.value.date|date("d/m/Y") }}">
                                <h2>Consultation  
                                    {{ counter }}
                                </h2>
                                <em>
                                    {{ rendezVousForm.vars.value.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                </em>
                                <div class="row">
                                    {{ form_row(rendezVousForm.date) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.thematique) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.heure) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.type) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.accompagnant) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.etat) }}
                                </div>
                                <div class="row">
                                    {{ form_row(rendezVousForm.motifRefus, {'required': false}) }}
                                </div>
                                <div class="row">
                                    <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                    <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                </div>
                            </li>
                        {% endfor %}
                    </ol>

                </div>
                <!-- .events-content -->
            </section>

            <div class="separator">
                <span id="entretiens" class="separator-text">Entretiens individuels</span>
            </div>

            <section class="cd-horizontal-timeline row" id="timeline-entretiens">
                <div class="timeline">
                    <div class="events-wrapper">
                        <div class="events">
                            <ol id="events-entretiens">
                                {% for entretienForm in form.entretiens %}
                                    <li>
                                        <a href="#0" data-date="{{ entretienForm.vars.value.date|date("d/m/Y") }}" {% if loop.last %} class="selected" {% else %} class="older-event" {% endif %}>
                                            {{ entretienForm.vars.value.date|format_datetime(pattern="d MMM", locale='fr') }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ol>

                            <span class="filling-line" aria-hidden="true"></span>
                        </div>
                        <!-- .events -->
                    </div>
                    <!-- .events-wrapper -->

                    <ul class="cd-timeline-navigation">
                        <li>
                            <a href="#0" class="prev inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="next">Next</a>
                        </li>
                    </ul>

                    <a class="new" data-toggle="modal" data-target="#entretienModal">
                        <span class="glyphicon glyphicon-plus"></span></a>
                    <!-- .cd-timeline-navigation -->
                </div>
                <!-- .timeline -->

                <div class="events-content">
                    <ol id="events-content-entretiens">
                        {% for entretienForm in form.entretiens %}
                            {% set counter = (counter | default(0)) + 1 %}
                            <li {% if loop.last %} class="selected" {% endif %} data-date="{{ entretienForm.vars.value.date|date("d/m/Y") }}">
                                <h2>Entretien individuel
                                    {{ counter }}
                                </h2>
                                <em>
                                    {{ entretienForm.vars.value.date|format_datetime(pattern="d MMMM YYYY", locale='fr')  }}
                                </em>
                                <div class="row">
                                    {{ form_row(entretienForm.date) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.thematique) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.heure) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.type) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.accompagnant, {'required': false}) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.etat) }}
                                </div>
                                <div class="row">
                                    {{ form_row(entretienForm.motifRefus, {'required': false}) }}
                                </div>
                                <div class="row">
                                    <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                    <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                </div>
                            </li>
                        {% endfor %}
                    </ol>
                </div>
                <!-- .events-content -->
            </section>

            <div class="separator">
                <span id="ateliers" class="separator-text">Ateliers</span>
            </div>

            <section class="cd-horizontal-timeline row" id="timeline-ateliers">
                <div class="timeline">
                    <div class="events-wrapper">
                        <div class="events">
                            <ol id="events-ateliers">
                                {% for atelierForm in form.ateliers %}
                                    <li>
                                        <a href="#0" data-date="{{ atelierForm.vars.value.date|date("d/m/Y") }}" {% if loop.last %} class="selected" {% else %} class="older-event" {% endif %}>
                                            {{ atelierForm.vars.value.date|format_datetime(pattern="d MMM", locale='fr') }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ol>

                            <span class="filling-line" aria-hidden="true"></span>
                        </div>
                        <!-- .events -->
                    </div>
                    <!-- .events-wrapper -->

                    <ul class="cd-timeline-navigation">
                        <li>
                            <a href="#0" class="prev inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="next">Next</a>
                        </li>
                    </ul>

                    <a class="new" data-toggle="modal" data-target="#atelierModal">
                        <span class="glyphicon glyphicon-plus"></span></a>
                    <!-- .cd-timeline-navigation -->
                </div>
                <!-- .timeline -->

                <div class="events-content">
                    <ol id="events-content-ateliers">
                        {% for atelierForm in form.ateliers %}
                            {% set counter = (counter | default(0)) + 1 %}
                            <li {% if loop.last %} class="selected" {% endif %} data-date="{{ atelierForm.vars.value.date|date("d/m/Y") }}">
                                <h2>Atelier
                                    {{ counter }}
                                </h2>
                                <em>
                                    {{ atelierForm.vars.value.date|format_datetime(pattern="d MMMM YYYY", locale='fr')  }}
                                </em>
                                <div class="row">
                                    {{ form_row(atelierForm.date) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.thematique) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.heure) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.type) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.accompagnant, {'required': false}) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.etat) }}
                                </div>
                                <div class="row">
                                    {{ form_row(atelierForm.motifRefus, {'required': false}) }}
                                </div>
                                <div class="row">
                                    <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                    <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                </div>
                            </li>
                        {% endfor %}
                    </ol>
                </div>
                <!-- .events-content -->
            </section>

            <div class="separator"></div>
            <div class="form-inline">
                <a href="{{ url('patient') }}" class="btn btn-default">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Retour
                </a>
                <a href="#0" class="btn btn-danger" data-toggle="modal" data-target="#supprModal">
                    <span class="glyphicon glyphicon-trash"></span>
                    Supprimer
                </a>
                {{ form_row(form.validation, {'attr': {'class': 'btn btn-primary'} }) }}
            </div>

            {{ form_row(form._token) }}
            {{ form_end(form, {'render_rest' : false}) }}
        </div>
        <!-- End content -->

        <!-- Modal supprPatient-->
        <div id="supprModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-warning"></span>
                            Suppression</h4>
                    </div>
                    <div class="modal-body">
                        <p>Êtes-vous sûr de vouloir supprimer ce patient ?</p>
                        <form method="post" action="{{ path('patient_delete', {'id': patient.id}) }}">
                            <input type="hidden" name="_method" value="DELETE">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ patient.id) }}">
                            <button class="btn btn-primary btn-block-md">Oui</button>
                            <button class="btn btn-danger btn-block-md" data-dismiss="modal">Non</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal addRendezVous-->
        <div id="rendezVousModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            Ajouter une consultation</h4>
                    </div>
                    <div class="modal-body">
                        {{ form_start(formRendezVous) }}
                        {{ form_errors(formRendezVous) }}
                        {{ form_row(formRendezVous.date, {'attr': {'autocomplete': 'off'} }) }}
                        {{ form_row(formRendezVous.thematique) }}
                        {{ form_row(formRendezVous.heure) }}
                        {{ form_row(formRendezVous.type) }}
                        {{ form_row(formRendezVous.accompagnant, {'required': false}) }}
                        {{ form_row(formRendezVous.etat, {'required': false}) }}
                        {{ form_row(formRendezVous.motifRefus, {'required': false}) }}
                        {{ form_row(formRendezVous._token) }}
                        {{ form_end(formRendezVous, {'render_rest' : false}) }}
                        <button id="rendezVous_add" class="btn btn-primary btn-block" data-dismiss="modal">Ajouter</button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal addEntretien-->
        <div id="entretienModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            Ajouter un entretien</h4>
                    </div>
                    <div class="modal-body">
                        {{ form_start(formEntretien) }}
                        {{ form_errors(formEntretien) }}
                        {{ form_row(formEntretien.date, {'attr': {'autocomplete': 'off'} }) }}
                        {{ form_row(formEntretien.thematique) }}
                        {{ form_row(formEntretien.heure) }}
                        {{ form_row(formEntretien.type) }}
                        {{ form_row(formEntretien.accompagnant, {'required': false}) }}
                        {{ form_row(formEntretien.etat) }}
                        {{ form_row(formEntretien.motifRefus, {'required': false}) }}
                        {{ form_row(formEntretien._token) }}
                        {{ form_end(formEntretien, {'render_rest' : false}) }}
                        <button id="entretien_add" class="btn btn-primary btn-block" data-dismiss="modal">Ajouter</button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal addAtelier-->
        <div id="atelierModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            Ajouter un atelier</h4>
                    </div>
                    <div class="modal-body">
                        {{ form_start(formAtelier) }}
                        {{ form_errors(formAtelier) }}
                        {{ form_row(formAtelier.date, {'attr': {'autocomplete': 'off'} }) }}
                        {{ form_row(formAtelier.thematique) }}
                        {{ form_row(formAtelier.heure) }}
                        {{ form_row(formAtelier.type) }}
                        {{ form_row(formAtelier.accompagnant, {'required': false}) }}
                        {{ form_row(formAtelier.etat) }}
                        {{ form_row(formAtelier.motifRefus, {'required': false}) }}
                        {{ form_row(formAtelier._token) }}
                        {{ form_end(formAtelier, {'render_rest' : false}) }}
                        <button id="atelier_add" class="btn btn-primary btn-block" data-dismiss="modal">Ajouter</button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal Suppression-->
        <div id="removeModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-warning"></span>
                            Suppression</h4>
                    </div>
                    <div class="modal-body">
                        <p>Êtes-vous sûr de vouloir supprimer cet élément ?</p>
                        <button class="btn btn-primary btn-block-md" data-dismiss="modal">Oui</button>
                        <button class="btn btn-danger btn-block-md" data-dismiss="modal">Non</button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler</button>
                    </div>

                </div>
            </div>
        </div>

        <a id="timeline_update"></a>
    </div>
{% endblock page_content %}

{% block javascripts %}
    <script src="{{ asset('js/script.js') }}"></script>
    <script src="{{ asset('js/timeline.js') }}"></script>
    <script type="text/javascript">

        alert_pos = {{ top }};
        patient_id = {{ patient.id }};

        function sort_date1(a, b) {
            let date1 = $(a).find('a').attr('data-date').split("/");
            let date2 = $(b).find('a').attr('data-date').split("/");
            return (new Date(date2[2], date2[1], date2[0])) < (new Date(date1[2], date1[1], date1[0])) ? 1 : -1;    
        }

        function sort_date2(a, b) {
            let date1 = $(a).attr('data-date').split("/");
            let date2 = $(b).attr('data-date').split("/");
            return (new Date(date2[2], date2[1], date2[0])) < (new Date(date1[2], date1[1], date1[0])) ? 1 : -1;    
        }

        function orderTimeline() {
            $('.cd-horizontal-timeline').each(function() {
                let timeline = $(this).find('.timeline ol')
                let events = $(this).find('.events-content ol')
                timeline.find('li').sort(sort_date1).appendTo(timeline);
                events.find('li').sort(sort_date2).appendTo(events);
            });
        }

        function updateForm() {
            orderTimeline();
            $('#timeline_update').trigger('click');
            $('.datepicker').datepicker({language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, todayHighlight: true, autoclose: true});
            changeSelectColor(null);
            sortSelect();
        }
        updateForm();

        $('.js-cd-save').on('click', function() {
            $('#patient_creation_form_validation').trigger('click');
        });

        {# Set select color #}
        function setSelectColor(obj) {
            let color = obj.find(":selected").attr("class");
            if (!color)
                return;
            obj.css({background: color});
            let index = obj.parents('li').index();
            let dot = obj.parents('.events-content').prev().find('ol li:eq(' + index + ') a');
            if (dot.hasClass('selected'))
                dot.removeClass().addClass('selected');
            else if (dot.hasClass('older-event'))
                dot.removeClass().addClass('older-event');
            else
                dot.removeClass()
            dot.addClass(color + '-after');
        }

        function changeSelectColor(obj)  {
            if (obj)
                setSelectColor(obj)
            else {
                $('section select').each(function () {
                    setSelectColor($(this));
                });
            }
        }

        function changeDotColor() {
            $('cd-horizontal-timeline, events a.selected::after')
        }

        $('ol, .modal').on('change', 'select', function() {
            changeSelectColor($(this));
        });

        {# Set time from select #}
        $("ol, .modal").on("change", ".get-hour", function() {
            let time = $(this).find(":selected").attr("data-hour");
            $(this).parents().eq(2).find(".set-hour").val(time);
        })

        {# Update datetime #}
        function sort_li(a, b){
            return ($(b).find("a").attr('data-date')) < ($(a).find("a").attr('data-date')) ? 1 : -1;    
        }

        $("ol").on("change", ".datepicker", function() {
            var month = ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
            let datetime = $(this).val().split("/");
            // $(this).parents("li").attr("data-date", $(this).val());
            $(this).parents("li").find("em").text(parseInt(datetime[0]) + " " + month[parseInt(datetime[1]) - 1] + " " + datetime[2]);
            let index = $(this).parents('li').index();
            let dot = $(this).parents('.events-content').prev().find('ol li:eq(' + index + ') a');
            dot.attr('data-date', $(this).val());
            dot.text(parseInt(datetime[0]) + " " + month[parseInt(datetime[1]) - 1]);
        })

        {# Alert #}

        function errorAlert() {
            $('body').prepend(
                '<div class="row alert alert-danger text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Erreur: date déjà existante !</div>'
            );
            alert_pos += 72;
        }

        function deleteAlert() {
            $('body').prepend(
                '<div class="row alert alert-success text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Suppression effectuée !</div>'
            );
            alert_pos += 72;
        }

        function editAlert() {
            $('body').prepend(
                '<div class="row alert alert-success text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Modification effectuée !</div>'
            );
            alert_pos += 72;
        }

        {# Delete #}

        $('.cd-horizontal-timeline').on("click", ".btn-danger", function () {
            $("#removeModal").modal()
            var btn = $(this);
            $('#removeModal .btn-primary').on('click', function () {
                var num = btn.closest('li').index();
                var timeline = btn.parents('.cd-horizontal-timeline');
                var date = btn.parents('li').find('.datepicker').val();

                timeline.find('ol').each(function () {
                    $(this).find('li:nth-child(' + (num + 1) + ')').remove();
                });
                timeline.find('.events li a').removeClass("selected").addClass("older-event");
                timeline.find('.events li:last-child a').removeClass("older-event").addClass("selected");
                timeline.find('.events-content li').removeClass("selected");
                timeline.find('.events-content li:last-child').addClass("selected");
                $('#timeline_update').trigger('click');

                if (timeline.is('#timeline-entretiens')) {
                    var id = btn.parents('li').find('.datepicker').attr("name").match(/\d+/)[0];
                    var url = "{{ path( 'entretien_remove', { 'id': 'entretien_id' }) }}";
                    url = url.replace("entretien_id", id);
                    $.ajax({url: url, type: "DELETE", success: function (resp) {deleteAlert()}});
                } else if (timeline.is('#timeline-ateliers')) {
                    var id = btn.parents('li').find('.datepicker').attr("name").match(/\d+/)[0];
                    var url = "{{ path( 'atelier_remove', { 'id': 'atelier_id' }) }}";
                    url = url.replace("atelier_id", id);
                    $.ajax({url: url, type: "DELETE", success: function (resp) {deleteAlert()}});
                } else if (timeline.is('#timeline-rendezVous')) {
                    var id = btn.parents('li').find('.datepicker').attr("name").match(/\d+/)[0];
                    var url = "{{ path( 'rendezVous_remove', { 'id': 'rendezVous_id' }) }}";
                    url = url.replace("rendezVous_id", id);
                    $.ajax({url: url, type: "DELETE", success: function (resp) {deleteAlert()}});
                }
            });
        });

        /* Ateliers
	    ============================================================================== */

        {# Edit #}

        $("#events-content-ateliers").on("click", ".btn-primary", function () {
            var arr = [], i = 0;
            $(this).parents("li").find("input, select").each(function() {
                arr[i++] = $(this).val();
            })
            var id = $(this).parents("li").find('input').attr('id').match(/\d+/)[0];
            var url = "{{ path('atelier_patch', { 'id': 'atelier_id' }) }}";
            url = url.replace("atelier_id", id);

            $.ajax({
                url: url,
                type: "POST",
                dataType: "json",
                data: {
                    "date": arr[0],
                    "thematique": arr[1],
                    "time": arr[2],
                    "type": arr[3],
                    "accompagnant": arr[4],
                    "etat": arr[5],
                    "motifRefus": arr[6],
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp)
                        editAlert();
                    else
                        errorAlert();
                }
            });
        })

        {# Add #}

        $("#atelier_add").on('click', function () {
            let date = $('#atelier_date').val();
            let thematique = $('#atelier_thematique').val();
            let time = $('#atelier_heure').val();
            let type = $('#atelier_type').val();
            let accompagnant = $('#atelier_accompagnant').val();
            let etat = $('#atelier_etat').val();
            let motifRefus = $('#atelier_motifRefus').val();

            $.ajax({
                url: "{{ path('atelier_add') }}",
                type: "POST",
                dataType: "json",
                data: {
                    "id": '{{ patient.id }}',
                    "date": date,
                    "thematique": thematique,
                    "time": time,
                    "type": type,
                    "accompagnant": accompagnant,
                    "etat": etat,
                    "motifRefus": motifRefus,
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp) {
                        var new_date = new Date(formatDate(date));
                        var date_h1 = new Intl.DateTimeFormat("fr-FR", {
                            month: 'short',
                            day: 'numeric'
                        }).format(new_date);
                        var date_em = new Intl.DateTimeFormat("fr-FR", {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }).format(new_date);
                        var nb = $("#events-content-ateliers").find('li').length;
                        var events = $('#events-ateliers');
                        $('#events-ateliers li a').removeClass("selected");
                        $('#events-ateliers li a').addClass("older-event");
                        $(document.createElement('li'))
                            .append('<a href=\"#0\" data-date=' + date + '>' + date_h1 + '</a>')
                            .appendTo(events);
                        $('#events-ateliers li:last-child a').addClass('selected');
                        $('#events-ateliers li:last-child a').removeClass('older-event');

                        var events_content = $('#events-content-ateliers');
                        $('#events-content-ateliers li').removeClass("selected");
                        $(events_content)
                            .append(`<li data-date=` + date + `>
                                        <h2>Atelier ` + (nb + 1) + `</h2>
                                        <em>` + date_em + `</em>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label required" for="patient_creation_form_ateliers_` + resp + `_date">Date</label>
                                            <input type="text" id="patient_creation_form_ateliers_` + resp + `_date" name="patient_creation_form[ateliers][` + resp + `][date]" required="required" class="datepicker form-control" value="` + date + `">
                                        </div></div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_ateliers_` + resp + `_thematique">Thématique</label><select id="patient_creation_form_ateliers_` + resp + `_thematique" name="patient_creation_form[ateliers][` + resp + `][thematique]" class="get-hour form-control"><option value=""></option><option value="Alim Sensation 1" data-hour="14:00">Alim Sensation 1</option><option value="Alim Sensation 2" data-hour="14:00">Alim Sensation 2</option><option value="Alim Sensation 3" data-hour="14:00">Alim Sensation 3</option><option value="Athérosclérose" data-hour="09:30">Athérosclérose</option><option value="Cuisine F&amp;L" data-hour="10:00">Cuisine F&amp;L</option><option value="Cuisine MG" data-hour="10:00">Cuisine MG</option><option value="Cuisine Poisson" data-hour="10:00" selected="selected">Cuisine Poisson</option><option value="Freins AP" data-hour="09:30">Freins AP</option><option value="Navigation" data-hour="14:00">Navigation</option><option value="PRM1" data-hour="14:00">PRM1</option><option value="PRM2" data-hour="14:00">PRM2</option><option value="Pharma" data-hour="10:30">Pharma</option><option value="Prévention stress" data-hour="14:00">Prévention stress</option><option value="Quantités" data-hour="10:00">Quantités</option><option value="Signes d'alerte" data-hour="09:30">Signes d'alerte</option><option value="Stress &amp; MCV" data-hour="14:00">Stress &amp; MCV</option><option value="Stress aigu" data-hour="14:00">Stress aigu</option><option value="Sucres" data-hour="14:00">Sucres</option><option value="Tabac" data-hour="14:00">Tabac</option><option value="Vécu/Cse de Soi" data-hour="14:00">Vécu/Cse de Soi</option></select></div>
                                        </div>
                                            <div class="row"><div class="form-group"><label class="control-label" for="patient_creation_form_ateliers_` + resp + `_heure">Heure</label><select id="patient_creation_form_ateliers_` + resp + `_heure" name="patient_creation_form[ateliers][` + resp + `][heure]" class="set-hour form-control"><option value=""></option><option value="09:30">09:30</option><option value="10:00" selected="selected">10:00</option><option value="10:30">10:30</option><option value="14:00">14:00</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_ateliers_` + resp + `_type">Type</label><select id="patient_creation_form_ateliers_` + resp + `_type" name="patient_creation_form[ateliers][` + resp + `][type]" class="form-control"><option value=""></option><option value="Ambu">Ambu</option><option value="Hospit">Hospit</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_ateliers_` + resp + `_accompagnant">Accompagnant</label><select id="patient_creation_form_ateliers_` + resp + `_accompagnant" name="patient_creation_form[ateliers][` + resp + `][accompagnant]" class="form-control"><option value=""></option><option value="oui">Oui</option><option value="non">Non</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_ateliers_` + resp + `_etat">Est-il/elle venu(e) ?</label><select id="patient_creation_form_ateliers_` + resp + `_etat" name="patient_creation_form[ateliers][` + resp + `][etat]" class="form-control" style="background: hotpink;"><option value="" class="white"></option><option value="Oui" class="hotpink">Oui</option><option value="Non" class="gold">Non</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_ateliers_` + resp + `_motifRefus">Motif de refus</label><input type="text" id="patient_creation_form_ateliers_` + resp + `_motifRefus" name="patient_creation_form[ateliers][` + resp + `][motifRefus]" class="form-control" value=` + motifRefus + `></div>
                                        </div>
                                        <div class="row">
                                            <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                            <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                        </div>
                                    </li>`)
                            .appendTo(events_content);
                        $('#patient_creation_form_ateliers_' + resp + '_thematique').val(thematique);
                        $('#patient_creation_form_ateliers_' + resp + '_heure').val(time);
                        $('#patient_creation_form_ateliers_' + resp + '_type').val(type);
                        $('#patient_creation_form_ateliers_' + resp + '_accompagnant').val(accompagnant);
                        $('#patient_creation_form_ateliers_' + resp + '_etat').val(etat);
                        $('#events-content-ateliers li:last-child').addClass('selected');

                        updateForm();
                    } else {
                        errorAlert();
                    }
                }
            });
        });

        /* Entretiens
		============================================================================== */

        {# Edit #}

        $("#events-content-entretiens").on("click", ".btn-primary", function () {
            var arr = [], i = 0;
            $(this).parents("li").find("input, select").each(function() {
                arr[i++] = $(this).val();
            })
            var id = $(this).parents("li").find('input').attr('id').match(/\d+/)[0];
            var url = "{{ path('entretien_patch', { 'id': 'entretien_id' }) }}";
            url = url.replace("entretien_id", id);

            $.ajax({
                url: url,
                type: "POST",
                dataType: "json",
                data: {
                    "date": arr[0],
                    "thematique": arr[1],
                    "time": arr[2],
                    "type": arr[3],
                    "accompagnant": arr[4],
                    "etat": arr[5],
                    "motifRefus": arr[6],
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp)
                        editAlert();
                    else
                        errorAlert();
                }
            });
        })

        {# Add #}

        $("#entretien_add").on('click', function () {
            var date = $('#entretien_date').val();
            var thematique = $('#entretien_thematique').val();
            var time = $('#entretien_heure').val();
            var type = $('#entretien_type').val();
            var accompagnant = $('#entretien_accompagnant').val();
            var etat = $('#entretien_etat').val();
            var motifRefus = $('#entretien_motifRefus').val();

            $.ajax({
                url: "{{ path('entretien_add') }}",
                type: "POST",
                dataType: "json",
                data: {
                    "id": '{{ patient.id }}',
                    "date": date,
                    "thematique": thematique,
                    "time": time,
                    "type": type,
                    "accompagnant": accompagnant,
                    "etat": etat,
                    "motifRefus": motifRefus,
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp) {
                        var new_date = new Date(formatDate(date));
                        var date_h1 = new Intl.DateTimeFormat("fr-FR", {
                            month: 'short',
                            day: 'numeric'
                        }).format(new_date);
                        var date_em = new Intl.DateTimeFormat("fr-FR", {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }).format(new_date);
                        var nb = $("#events-content-entretiens").find('li').length;
                        var events = $('#events-entretiens');
                        $('#events-entretiens li a').removeClass("selected");
                        $('#events-entretiens li a').addClass("older-event");
                        $(document.createElement('li'))
                            .append('<a href=\"#0\" data-date=' + date + '>' + date_h1 + '</a>')
                            .appendTo(events);
                        $('#events-entretiens li:last-child a').addClass('selected');
                        $('#events-entretiens li:last-child a').removeClass('older-event');

                        var events_content = $('#events-content-entretiens');
                        $('#events-content-entretiens li').removeClass("selected");
                        $(events_content)
                            .append(`<li data-date=` + date + `>
                                        <h2>Entretien individuel ` + (nb + 1) + `</h2>
                                        <em>` + date_em + `</em><div class="row">
                                        <div class="row"><div class="form-group">
                                            <label class="control-label required" for="patient_creation_form_entretiens_` + resp + `_date">Date prévue</label><input type="text" id="patient_creation_form_entretiens_` + resp + `_date" name="patient_creation_form[entretiens][` + resp + `][date]" required="required" class="datepicker form-control" value="` + date + `"></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label required" for="patient_creation_form_entretiens_` + resp + `_thematique">Thématique</label><select id="patient_creation_form_entretiens_` + resp + `_thematique" name="patient_creation_form[entretiens][` + resp + `][thematique]" required="required" class="form-control"><option value=""></option><option value="Activité physique">Activité physique</option><option value="Athérosclérose">Athérosclérose</option><option value="Diabète">Diabète</option><option value="HTA" selected="selected">HTA</option><option value="Motivation AP">Motivation AP</option><option value="Motivation FDR">Motivation FDR</option><option value="Motivation navigation">Motivation navigation</option><option value="Motivation tabac">Motivation tabac</option><option value="Navigation">Navigation</option><option value="Réactu 1">Réactu 1</option><option value="Réactu 2">Réactu 2</option><option value="Réactu 3">Réactu 3</option><option value="Réactu 4">Réactu 4</option><option value="Réactu 5">Réactu 5</option><option value="Réactu 6">Réactu 6</option><option value="Signes alerte et CAT">Signes alerte et CAT</option><option value="Tabac">Tabac</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_entretiens_` + resp + `_heure">Heure</label><select id="patient_creation_form_entretiens_` + resp + `_heure" name="patient_creation_form[entretiens][` + resp + `][heure]" class="form-control"><option value=""></option><option value="09:15">09:15</option><option value="10:30">10:30</option><option value="11:45" selected="selected">11:45</option><option value="13:30">13:30</option><option value="14:45">14:45</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_entretiens_` + resp + `_type">Type</label><select id="patient_creation_form_entretiens_` + resp + `_type" name="patient_creation_form[entretiens][` + resp + `][type]" class="form-control"><option value=""></option><option value="Ambu">Ambu</option><option value="Hospit">Hospit</option><option value="Tel">Tel</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_entretiens_` + resp + `_accompagnant">Accompagnant</label><select id="patient_creation_form_entretiens_` + resp + `_accompagnant" name="patient_creation_form[entretiens][` + resp + `][accompagnant]" class="form-control"><option value=""></option><option value="oui">Oui</option><option value="non">Non</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_entretiens_` + resp + `_etat">A-t-il eu lieu ?</label><select id="patient_creation_form_entretiens_` + resp + `_etat" name="patient_creation_form[entretiens][` + resp + `][etat]" class="form-control" style="background: hotpink;"><option value="" class="white"></option><option value="Oui" class="hotpink">Oui</option><option value="Non" class="gold">Non</option></select></div>
                                        </div>
                                        <div class="row"><div class="form-group">
                                            <label class="control-label" for="patient_creation_form_entretiens_` + resp + `_motifRefus">Motif de refus</label><input type="text" id="patient_creation_form_entretiens_` + resp + `_motifRefus" name="patient_creation_form[entretiens][` + resp + `][motifRefus]" class="form-control" value=` + motifRefus + `></div>
                                        </div>
                                        <div class="row">
                                            <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                            <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                        </div>
                                    </li>`)
                            .appendTo(events_content);
                        $('#patient_creation_form_entretiens_' + resp + '_thematique').val(thematique);
                        $('#patient_creation_form_entretiens_' + resp + '_heure').val(time);
                        $('#patient_creation_form_entretiens_' + resp + '_type').val(type);
                        $('#patient_creation_form_entretiens_' + resp + '_accompagnant').val(accompagnant);
                        $('#patient_creation_form_entretiens_' + resp + '_etat').val(etat);
                        $('#events-content-entretiens li:last-child').addClass('selected');

                        updateForm();
                    } else {
                        errorAlert();
                    }
                }
            });
        });

        /* RendezVous
		============================================================================== */

        {# Edit #}

        $("#events-content-rendezVous").on("click", ".btn-primary", function () {
            var arr = [], i = 0;
            $(this).parents("li").find("input, select").each(function() {
                arr[i++] = $(this).val();
            })
            var id = $(this).parents("li").find('input').attr('id').match(/\d+/)[0];
            var url = "{{ path('rendezVous_patch', { 'id': 'rendezVous_id' }) }}";
            url = url.replace("rendezVous_id", id);

            $.ajax({
                url: url,
                type: "POST",
                dataType: "json",
                data: {
                    "date": arr[0],
                    "thematique": arr[1],
                    "time": arr[2],
                    "type": arr[3],
                    "accompagnant": arr[4],
                    "etat": arr[5],
                    "motifRefus": arr[6],
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp)
                        editAlert();
                    else
                        errorAlert();
                }
            });
        })

        {# Add #}

        $("#rendezVous_add").on('click', function () {
            let date = $('#rendez_vous_date').val();
            let thematique = $('#rendez_vous_thematique').val();
            let time = $('#rendez_vous_heure').val();
            let type = $('#rendez_vous_type').val();
            let accompagnant = $('#rendez_vous_accompagnant').val();
            let etat = $('#rendez_vous_etat').val();
            let motifRefus = $('#rendez_vous_motifRefus').val();

            $.ajax({
                url: "{{ path('rendezVous_add') }}",
                type: "POST",
                dataType: "json",
                data: {
                    "id": '{{ patient.id }}',
                    "date": date,
                    "thematique": thematique,
                    "time": time,
                    "type": type,
                    "accompagnant": accompagnant,
                    "etat": etat,
                    "motifRefus": motifRefus,
                    "patient": patient_id,
                },
                success: function (resp) {
                    if (resp) {
                        var new_date = new Date(formatDate(date));
                        var date_h1 = new Intl.DateTimeFormat("fr-FR", {
                            month: 'short',
                            day: 'numeric'
                        }).format(new_date);
                        var date_em = new Intl.DateTimeFormat("fr-FR", {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }).format(new_date);
                        var nb = $("#events-content-rendezVous").find('li').length;
                        var events = $('#events-rendezVous');
                        $('#events-rendezVous li a').removeClass("selected");
                        $('#events-rendezVous li a').addClass("older-event");
                        $(document.createElement('li'))
                            .append('<a href=\"#0\" data-date=' + date + '>' + date_h1 + '</a>')
                            .appendTo(events);
                        $('#events-rendezVous li:last-child a').addClass('selected');
                        $('#events-rendezVous li:last-child a').removeClass('older-event');

                        var events_content = $('#events-content-rendezVous');
                        $('#events-content-rendezVous li').removeClass("selected");
                        $(events_content)
                            .append(`<li data-date=` + date + `>
                                        <h2>Consultation ` + (nb + 1) + `</h2>
                                        <em>` + date_em + `</em>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label required" for="patient_creation_form_rendezVous_` + resp + `_date">Date prévue</label><input type="text" id="patient_creation_form_rendezVous_` + resp + `_date" name="patient_creation_form[rendezVous][` + resp + `][date]" required="required" class="datepicker form-control" value="` + date + `"></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label required" for="patient_creation_form_rendezVous_` + resp + `_thematique">Thématique</label><select id="patient_creation_form_rendezVous_` + resp + `_thematique" name="patient_creation_form[rendezVous][` + resp + `][thematique]" required="required" class="form-control"><option value=""></option><option value="Consultation psychologue">Consultation psychologue</option><option value="Consultation diététicienne">Consultation diététicienne</option><option value="Consultation pharmacienne">Consultation pharmacienne</option></select></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label" for="patient_creation_form_rendezVous_` + resp + `_heure">Heure</label><select id="patient_creation_form_rendezVous_` + resp + `_heure" name="patient_creation_form[rendezVous][` + resp + `][heure]" class="form-control"><option value=""></option><option value="09:00">09:00</option><option value="09:30">09:30</option><option value="10:00">10:00</option><option value="10:30">10:30</option><option value="11:00">11:00</option><option value="11:30">11:30</option><option value="12:00">12:00</option><option value="13:00">13:00</option><option value="13:30">13:30</option><option value="14:00">14:00</option><option value="14:30">14:30</option><option value="15:00">15:00</option><option value="15:30">15:30</option><option value="16:00">16:00</option></select></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label" for="patient_creation_form_rendezVous_` + resp + `_type">Type</label><select id="patient_creation_form_rendezVous_` + resp + `_type" name="patient_creation_form[rendezVous][` + resp + `][type]" class="form-control"><option value=""></option><option value="Ambu">Ambu</option><option value="Tel">Tel</option><option value="Hospi">Hospi</option></select></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label" for="patient_creation_form_rendezVous_` + resp + `_accompagnant">Accompagnant</label><select id="patient_creation_form_rendezVous_` + resp + `_accompagnant" name="patient_creation_form[rendezVous][` + resp + `][accompagnant]" class="form-control"><option value=""></option><option value="oui">Oui</option><option value="non">Non</option></select></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label" for="patient_creation_form_rendezVous_` + resp + `_etat">A-t-il eu lieu ?</label><select id="patient_creation_form_rendezVous_` + resp + `_etat" name="patient_creation_form[rendezVous][` + resp + `][etat]" class="form-control" style="background: white;"><option value="" class="white"></option><option value="Oui" class="hotpink">Oui</option><option value="Non" class="gold">Non</option></select></div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group"><label class="control-label" for="patient_creation_form_rendezVous_` + resp + `_motifRefus">Motif de refus</label><input type="text" id="patient_creation_form_rendezVous_` + resp + `_motifRefus" name="patient_creation_form[rendezVous][` + resp + `][motifRefus]" class="form-control" value=` + motifRefus + `></div>
                                        </div>
                                        <div class="row">
                                            <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                            <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                        </div>
                                    </li>`)
                            .appendTo(events_content);
                        $('#patient_creation_form_rendezVous_' + resp + '_thematique').val(thematique);
                        $('#patient_creation_form_rendezVous_' + resp + '_heure').val(time);
                        $('#patient_creation_form_rendezVous_' + resp + '_type').val(type);
                        $('#patient_creation_form_rendezVous_' + resp + '_accompagnant').val(accompagnant);
                        $('#patient_creation_form_rendezVous_' + resp + '_etat').val(etat);
                        $('#events-content-rendezVous li:last-child').addClass('selected');

                        updateForm();
                    } else {
                        errorAlert();
                    }
                }
            });
        });

        /* 
	    ============================================================================== */

        function formatDate(input) {
            var datePart = input.match(/\d+/g),
                year = datePart[2] //.substring(2),  get only two digits
                month = datePart[1],
                day = datePart[0];
            return year + '-' + month + '-' + day;
        }

        function resetErrors() {
            $('input, select').removeClass('is-invalid');
            $(".invalid-feedback").remove();
        }

        function sortSelect() {
            $('.container-fluid').find('select').each(function() {
                let sel = $(this);
                let selected = sel.val();
                let opts_list = sel.find('option');
                opts_list.sort(function(a, b) { return $(a).text() > $(b).text() ? 1 : -1; });
                sel.html('').append(opts_list);
                sel.val(selected);
            });
        }

    </script>



    {# function reload_js(src) {
       	$('script[src="' + src + '"]').remove();
       	$('<script>').attr('src', src).appendTo('body');
   	} #}

    {# $.getScript("{{ asset('js/timeline.js') }}"); #}
    {# $(this).closest('tr').remove(); #}
    {# $('section#timeline-entretiens').load(location.href + ' #timeline-entretiens'); #}

{% endblock %}