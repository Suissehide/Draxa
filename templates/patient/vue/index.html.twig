{% extends 'layout.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/timeline.css') }}">
{% endblock %}

{% block title %}
    Vue
    {{ patient.nom }}
{% endblock %}

{% block toolbar_component %}
    <button class="cd cd-save js-cd-save"><span class="glyphicon glyphicon-floppy-disk"></span></button>
    <a class="cd cd-back js-cd-back" href="#"><span class="glyphicon glyphicon-chevron-left"></span></a>
{% endblock %}

{% form_theme form 'form-theme.html.twig' %}

{% block page_content %}

    <div class="wrapper scrollbar">
        <h1 id="top">Index |
            {{ patient.nom }}</h1>
        <div class="nav-bar" id="navMenu">
            <div class="btn-group btn-nav">
                <a href="#" class="btn btn-default js-cd-back" id="btn-back">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Retour
                </a>
                <a href="#details" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-search"></span>
                    Informations
                </a>
                <a href="#consultations" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-book"></span>
                    Consultations
                </a>
                <a href="#entretiens" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-bookmark"></span>
                    Entretiens individuels
                </a>
                <a href="#ateliers" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-scissors"></span>
                    Ateliers
                </a>
                <a href="#educatives" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-education"></span>
                    Semaines éducatives
                </a>
                <a href="#coachings" class="js-scrollTo btn btn-primary" data-row-id="0">
                    <span class="glyphicon glyphicon-flash"></span>
                    Coachings PRM
                </a>
            </div>
        </div>

        <div class="content">

            {{ form_start(form) }}
            {{ form_errors(form) }}

            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.soignantReferent, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.observ, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.divers, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.notes, {'required': false}) }}
                </div>
            </div>
            <div class="separator">
                <span id="details" class="separator-text">Détails</span>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.sexe) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.nom) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.prenom) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.date) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.tel1) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.tel2, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.email, {'attr': {'pattern': '[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,63}$'}}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.distance, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.etude, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.profession, {'required': false}) }}
                </div>
                <div class="col-md-2">
                    {{ form_row(form.activite, {'required': false}) }}
                </div>
            </div>
            <div class="separator">
                <span class="separator-text">Données à l'inclusion</span>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.diagnostic, {'required': false}) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.dedate) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.mode) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.orientation, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    {{ form_row(form.etpdecision, {'required': false}) }}
                </div>
                <div class="col-md-3">
                    {{ form_row(form.progetp, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.precisions, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.precisionsperso, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.objectif, {'required': false}) }}
                </div>
            </div>

            <div class="separator">
                <span id="fin" class="separator-text">Données à la sortie</span>
            </div>
            <div class="row">
                <div class="col-md-3">
                    {{ form_row(form.dentree, {'required': false}) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    {{ form_row(form.motif, {'required': false}) }}
                </div>
                <div class="col-md-4">
                    {{ form_row(form.etp, {'required': false}) }}
                </div>
            </div>


            <div class="separator">
                <span id="consultations" class="separator-text">Consultations</span>
            </div>

            <!-- CONSULTATIONS -->
            <section class="cd-h-timeline" id="timeline-consultations">
                <div class="cd-h-timeline__container">
                    <div class="cd-h-timeline__dates">
                        <div class="cd-h-timeline__line">
                            <ol id="events-consultations">
                                {% for consultation in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                                    {% if consultation.categorie == 'Consultation' %}
                                        <li>
                                            <a class="cd-h-timeline__date" href="#0"
                                               data-date="{{ consultation.date|date("d/m/Y") }}T{{ consultation.heure|date("h:m") }}">
                                                {{ consultation.date|format_datetime(pattern="d MMM", locale='fr') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                            <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#0"
                               class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                        </li>
                    </ul>

                    <a id="js-consultation" class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </div>

                <div class="cd-h-timeline__events">
                    <ol id="events-content-consultations">
                        {% for consultation in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                            {% set counter = (counter | default(0)) + 1 %}
                            {% if consultation.categorie == 'Consultation' %}
                                <li class="cd-h-timeline__event"
                                    data-date="{{ consultation.date|date("d/m/Y") }}T{{ consultation.heure|date("h:m") }}"
                                    data-id="{{ consultation.id }}">
                                    <h2 class="cd-h-timeline__event-title">Consultation</h2>
                                    <em class="cd-h-timeline__event-date">
                                        {{ consultation.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                    </em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_date">Date
                                                        prévue</label>
                                                    <input disabled type="text"
                                                           id="patient_creation_form_consultations_{{ consultation.id }}_date"
                                                           name="patient_creation_form[consultation][{{ consultation.id }}][date]"
                                                           required="required" class="datepicker form-control"
                                                           value="{{ consultation.date|date("d/m/Y") }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_heure">Heure</label>
                                                    <select disabled type="text"
                                                            id="patient_creation_form_consultations_{{ consultation.id }}_heure"
                                                            name="patient_creation_form[consultation][{{ consultation.id }}][heure]"
                                                            required="required" class="form-control heure">
                                                        <option value="{{ consultation.slot }}"
                                                                selected>{{ consultation.heure|date("H:i") }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_thematique">
                                                        Thématique
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_consultations_{{ consultation.id }}_thematique"
                                                            class="form-control thematique">
                                                        <option value="" {% if consultation.thematique == '' %} selected="selected" {% endif %}></option>
                                                        {% for thematique in thematiques[0] %}
                                                            <option value="{{ thematique }}" {% if consultation.thematique == thematique %} selected="selected" {% endif %}>{{ thematique }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_type">
                                                        Type
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_consultations_{{ consultation.id }}_type"
                                                            name="patient_creation_form[consultation][{{ consultation.id }}][type]"
                                                            class="form-control type">
                                                        <option value="" {% if consultation.type == "" %} selected="selected" {% endif %}></option>
                                                        <option value="Ambu" {% if consultation.type == "Ambu" %} selected="selected" {% endif %}>
                                                            Ambu
                                                        </option>
                                                        <option value="Tel" {% if consultation.type == "Tel" %} selected="selected" {% endif %}>
                                                            Tel
                                                        </option>
                                                        <option value="Hospit" {% if consultation.type == "Hospit" %} selected="selected" {% endif %}>
                                                            Hospit
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_consultations_{{ consultation.id }}_accompagnant"
                                                            name="patient_creation_form[consultation][{{ consultation.id }}][accompagnant]"
                                                            class="form-control">
                                                        <option value="" {% if consultation.accompagnant == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non" {% if consultation.accompagnant == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui" {% if consultation.accompagnant == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_etat">A-t-il
                                                        eu lieu ?</label>
                                                    <select id="patient_creation_form_consultations_{{ consultation.id }}_etat"
                                                            name="patient_creation_form[consultation][{{ consultation.id }}][etat]"
                                                            class="form-control" style="background: gold;">
                                                        <option value=""
                                                                class="white" {% if consultation.etat == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non"
                                                                class="gold" {% if consultation.etat == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui"
                                                                class="hotpink" {% if consultation.etat == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_motifRefus">Motif
                                                        de refus</label>
                                                    <input type="text"
                                                           id="patient_creation_form_consultations_{{ consultation.id }}_motifRefus"
                                                           name="patient_creation_form[consultation][{{ consultation.id }}][motifRefus]"
                                                           class="form-control" value="{{ consultation.motifRefus }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_consultations_{{ consultation.id }}_notes">Notes
                                                        de transmission</label>
                                                    <textarea type="text"
                                                              id="patient_creation_form_consultations_{{ consultation.id }}_notes"
                                                              name="patient_creation_form[consultation][{{ consultation.id }}][notes]"
                                                              class="form-control">{{ consultation.notes }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier
                                                </button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>

                </div>
            </section>


            <div class="separator">
                <span id="entretiens" class="separator-text">Entretiens individuels</span>
            </div>

            <!-- ENTRETIENS INDIVIDUELS -->
            <section class="cd-h-timeline" id="timeline-entretiens">
                <div class="cd-h-timeline__container">
                    <div class="cd-h-timeline__dates">
                        <div class="cd-h-timeline__line">
                            <ol id="events-entretiens">
                                {% for entretien in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                                    {% if entretien.categorie == 'Entretien' %}
                                        <li>
                                            <a class="cd-h-timeline__date" href="#0"
                                               data-date="{{ entretien.date|date("d/m/Y") }}T{{ entretien.heure|date("h:m") }}">
                                                {{ entretien.date|format_datetime(pattern="d MMM", locale='fr') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                            <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#0"
                               class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                        </li>
                    </ul>

                    <a id="js-entretien" class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </div>

                <div class="cd-h-timeline__events">
                    <ol id="events-content-entretiens">
                        {% for entretien in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                            {% if entretien.categorie == 'Entretien' %}
                                <li class="cd-h-timeline__event"
                                    data-date="{{ entretien.date|date("d/m/Y") }}T{{ entretien.heure|date("h:m") }}"
                                    data-id="{{ entretien.id }}">
                                    <h2 class="cd-h-timeline__event-title">Entretien</h2>
                                    <em class="cd-h-timeline__event-date">
                                        {{ entretien.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                    </em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_date">Date
                                                        prévue</label>
                                                    <input disabled type="text"
                                                           id="patient_creation_form_entretiens_{{ entretien.id }}_date"
                                                           name="patient_creation_form[entretien][{{ entretien.id }}][date]"
                                                           required="required" class="datepicker form-control"
                                                           value="{{ entretien.date|date("d/m/Y") }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_heure">Heure</label>
                                                    <select disabled type="text"
                                                            id="patient_creation_form_entretiens_{{ entretien.id }}_heure"
                                                            name="patient_creation_form[entretien][{{ entretien.id }}][heure]"
                                                            required="required" class="form-control heure">
                                                        <option value="{{ entretien.slot }}"
                                                                selected>{{ entretien.heure|date("H:i") }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_thematique">
                                                        Thématique
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_entretiens_{{ entretien.id }}_thematique"
                                                            class="form-control thematique">
                                                        <option value="" {% if entretien.thematique == '' %} selected="selected" {% endif %}></option>
                                                        {% for thematique in thematiques[1] %}
                                                        <option value="{{ thematique }}" {% if entretien.thematique == thematique %} selected="selected" {% endif %}>{{ thematique }}</option>
                                                        {% endfor %}²
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_type">
                                                        Type
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_entretiens_{{ entretien.id }}_type"
                                                            name="patient_creation_form[entretien][{{ entretien.id }}][type]"
                                                            class="form-control type">
                                                        <option value="" {% if entretien.type == "" %} selected="selected" {% endif %}></option>
                                                        <option value="Ambu" {% if entretien.type == "Ambu" %} selected="selected" {% endif %}>
                                                            Ambu
                                                        </option>
                                                        <option value="Tel" {% if entretien.type == "Tel" %} selected="selected" {% endif %}>
                                                            Tel
                                                        </option>
                                                        <option value="Hospit" {% if entretien.type == "Hospit" %} selected="selected" {% endif %}>
                                                            Hospit
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_entretiens_{{ entretien.id }}_accompagnant"
                                                            name="patient_creation_form[entretien][{{ entretien.id }}][accompagnant]"
                                                            class="form-control">
                                                        <option value="" {% if entretien.accompagnant == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non" {% if entretien.accompagnant == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui" {% if entretien.accompagnant == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_etat">A-t-il
                                                        eu lieu ?</label>
                                                    <select id="patient_creation_form_entretiens_{{ entretien.id }}_etat"
                                                            name="patient_creation_form[entretien][{{ entretien.id }}][etat]"
                                                            class="form-control" style="background: gold;">
                                                        <option value=""
                                                                class="white" {% if entretien.etat == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non"
                                                                class="gold" {% if entretien.etat == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui"
                                                                class="hotpink" {% if entretien.etat == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_motifRefus">Motif
                                                        de refus</label>
                                                    <input type="text"
                                                           id="patient_creation_form_entretiens_{{ entretien.id }}_motifRefus"
                                                           name="patient_creation_form[entretien][{{ entretien.id }}][motifRefus]"
                                                           class="form-control" value="{{ entretien.motifRefus }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_entretiens_{{ entretien.id }}_notes">Notes
                                                        de transmission</label>
                                                    <textarea type="text"
                                                              id="patient_creation_form_entretiens_{{ entretien.id }}_notes"
                                                              name="patient_creation_form[entretien][{{ entretien.id }}][notes]"
                                                              class="form-control">{{ entretien.notes }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier
                                                </button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>

                </div>
            </section>


            <div class="separator">
                <span id="coachings" class="separator-text">Coachings PRM</span>
            </div>

            <!-- COACHING PRM -->
            <section class="cd-h-timeline" id="timeline-coachings">
                <div class="cd-h-timeline__container">
                    <div class="cd-h-timeline__dates">
                        <div class="cd-h-timeline__line">
                            <ol id="events-coachings">
                                {% for coaching in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                                    {% if coaching.categorie == 'Coaching' %}
                                        <li>
                                            <a class="cd-h-timeline__date" href="#0"
                                               data-date="{{ coaching.date|date("d/m/Y") }}T{{ coaching.heure|date("h:m") }}">
                                                {{ coaching.date|format_datetime(pattern="d MMM", locale='fr') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                            <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#0"
                               class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                        </li>
                    </ul>

                    <a id="js-coaching" class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </div>

                <div class="cd-h-timeline__events">
                    <ol id="events-content-coachings">
                        {% for coaching in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                            {% if coaching.categorie == 'Coaching' %}
                                <li class="cd-h-timeline__event"
                                    data-date="{{ coaching.date|date("d/m/Y") }}T{{ coaching.heure|date("h:m") }}"
                                    data-id="{{ coaching.id }}">
                                    <h2 class="cd-h-timeline__event-title">Coaching PRM</h2>
                                    <em class="cd-h-timeline__event-date">
                                        {{ coaching.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                    </em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_date">Date
                                                        prévue</label>
                                                    <input disabled type="text"
                                                           id="patient_creation_form_coachings_{{ coaching.id }}_date"
                                                           name="patient_creation_form[coaching][{{ coaching.id }}][date]"
                                                           required="required" class="datepicker form-control"
                                                           value="{{ coaching.date|date("d/m/Y") }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_heure">Heure</label>
                                                    <select disabled type="text"
                                                            id="patient_creation_form_coachings_{{ coaching.id }}_heure"
                                                            name="patient_creation_form[coaching][{{ coaching.id }}][heure]"
                                                            required="required" class="form-control heure">
                                                        <option value="{{ coaching.slot }}"
                                                                selected>{{ coaching.heure|date("H:i") }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_thematique">
                                                        Thématique
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_coachings_{{ coaching.id }}_thematique"
                                                            class="form-control thematique">
                                                        <option value="" {% if coaching.thematique == '' %} selected="selected" {% endif %}></option>
                                                        {% for thematique in thematiques[3] %}
                                                            <option value="{{ thematique }}" {% if coaching.thematique == thematique %} selected="selected" {% endif %}>{{ thematique }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_type">
                                                        Type
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_coachings_{{ coaching.id }}_type"
                                                            name="patient_creation_form[coaching][{{ coaching.id }}][type]"
                                                            class="form-control type">
                                                        <option value="" {% if coaching.type == "" %} selected="selected" {% endif %}></option>
                                                        <option value="Ambu" {% if coaching.type == "Ambu" %} selected="selected" {% endif %}>
                                                            Ambu
                                                        </option>
                                                        <option value="Tel" {% if coaching.type == "Tel" %} selected="selected" {% endif %}>
                                                            Tel
                                                        </option>
                                                        <option value="Hospit" {% if coaching.type == "Hospit" %} selected="selected" {% endif %}>
                                                            Hospit
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_coachings_{{ coaching.id }}_accompagnant"
                                                            name="patient_creation_form[coaching][{{ coaching.id }}][accompagnant]"
                                                            class="form-control">
                                                        <option value="" {% if coaching.accompagnant == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non" {% if coaching.accompagnant == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui" {% if coaching.accompagnant == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_etat">A-t-il
                                                        eu lieu ?</label>
                                                    <select id="patient_creation_form_coachings_{{ coaching.id }}_etat"
                                                            name="patient_creation_form[coaching][{{ coaching.id }}][etat]"
                                                            class="form-control" style="background: gold;">
                                                        <option value=""
                                                                class="white" {% if coaching.etat == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non"
                                                                class="gold" {% if coaching.etat == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui"
                                                                class="hotpink" {% if coaching.etat == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_motifRefus">Motif
                                                        de refus</label>
                                                    <input type="text"
                                                           id="patient_creation_form_coachings_{{ coaching.id }}_motifRefus"
                                                           name="patient_creation_form[coaching][{{ coaching.id }}][motifRefus]"
                                                           class="form-control" value="{{ coaching.motifRefus }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_coachings_{{ coaching.id }}_notes">Notes
                                                        de transmission</label>
                                                    <textarea type="text"
                                                              id="patient_creation_form_coachings_{{ coaching.id }}_notes"
                                                              name="patient_creation_form[coaching][{{ coaching.id }}][notes]"
                                                              class="form-control">{{ coaching.notes }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier
                                                </button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>

                </div>
            </section>


            <div class="separator">
                <span id="ateliers" class="separator-text">Ateliers</span>
            </div>

            <!-- ATELIER -->
            <section class="cd-h-timeline" id="timeline-ateliers">
                <div class="cd-h-timeline__container">
                    <div class="cd-h-timeline__dates">
                        <div class="cd-h-timeline__line">
                            <ol id="events-ateliers">
                                {% for atelier in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                                    {% if atelier.categorie == 'Atelier' %}
                                        <li>
                                            <a class="cd-h-timeline__date" href="#0"
                                               data-date="{{ atelier.date|date("d/m/Y") }}T{{ atelier.heure|date("h:m") }}">
                                                {{ atelier.date|format_datetime(pattern="d MMM", locale='fr') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                            <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#0"
                               class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                        </li>
                    </ul>

                    <a id="js-atelier" class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </div>

                <div class="cd-h-timeline__events">
                    <ol id="events-content-ateliers">
                        {% for atelier in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                            {% if atelier.categorie == 'Atelier' %}
                                <li class="cd-h-timeline__event"
                                    data-date="{{ atelier.date|date("d/m/Y") }}T{{ atelier.heure|date("h:m") }}"
                                    data-id="{{ atelier.id }}">
                                    <h2 class="cd-h-timeline__event-title">Atelier</h2>
                                    <em class="cd-h-timeline__event-date">
                                        {{ atelier.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                    </em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_date">Date
                                                        prévue</label>
                                                    <input disabled type="text"
                                                           id="patient_creation_form_ateliers_{{ atelier.id }}_date"
                                                           name="patient_creation_form[atelier][{{ atelier.id }}][date]"
                                                           required="required" class="datepicker form-control"
                                                           value="{{ atelier.date|date("d/m/Y") }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_heure">Heure</label>
                                                    <select disabled type="text"
                                                            id="patient_creation_form_ateliers_{{ atelier.id }}_heure"
                                                            name="patient_creation_form[atelier][{{ atelier.id }}][heure]"
                                                            required="required" class="form-control heure">
                                                        <option value="{{ atelier.slot }}"
                                                                selected>{{ atelier.heure|date("H:i") }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_thematique">
                                                        Thématique
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_ateliers_{{ atelier.id }}_thematique"
                                                            class="form-control thematique">
                                                        <option value="" {% if atelier.thematique == '' %} selected="selected" {% endif %}></option>
                                                        {% for thematique in thematiques[2] %}
                                                            <option value="{{ thematique }}" {% if atelier.thematique == thematique %} selected="selected" {% endif %}>{{ thematique }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_type">
                                                        Type
                                                    </label>
                                                    <select type="text"
                                                            id="patient_creation_form_ateliers_{{ atelier.id }}_type"
                                                            name="patient_creation_form[atelier][{{ atelier.id }}][type]"
                                                            class="form-control type">
                                                        <option value="" {% if atelier.type == "" %} selected="selected" {% endif %}></option>
                                                        <option value="Ambu" {% if atelier.type == "Ambu" %} selected="selected" {% endif %}>
                                                            Ambu
                                                        </option>
                                                        <option value="Tel" {% if atelier.type == "Tel" %} selected="selected" {% endif %}>
                                                            Tel
                                                        </option>
                                                        <option value="Hospit" {% if atelier.type == "Hospit" %} selected="selected" {% endif %}>
                                                            Hospit
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_ateliers_{{ atelier.id }}_accompagnant"
                                                            name="patient_creation_form[atelier][{{ atelier.id }}][accompagnant]"
                                                            class="form-control">
                                                        <option value="" {% if atelier.accompagnant == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non" {% if atelier.accompagnant == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui" {% if atelier.accompagnant == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_etat">A-t-il
                                                        eu lieu ?</label>
                                                    <select id="patient_creation_form_ateliers_{{ atelier.id }}_etat"
                                                            name="patient_creation_form[atelier][{{ atelier.id }}][etat]"
                                                            class="form-control" style="background: gold;">
                                                        <option value=""
                                                                class="white" {% if atelier.etat == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non"
                                                                class="gold" {% if atelier.etat == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui"
                                                                class="hotpink" {% if atelier.etat == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_motifRefus">Motif
                                                        de refus</label>
                                                    <input type="text"
                                                           id="patient_creation_form_ateliers_{{ atelier.id }}_motifRefus"
                                                           name="patient_creation_form[atelier][{{ atelier.id }}][motifRefus]"
                                                           class="form-control" value="{{ atelier.motifRefus }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_ateliers_{{ atelier.id }}_notes">Notes
                                                        de transmission</label>
                                                    <textarea type="text"
                                                              id="patient_creation_form_ateliers_{{ atelier.id }}_notes"
                                                              name="patient_creation_form[atelier][{{ atelier.id }}][notes]"
                                                              class="form-control">{{ atelier.notes }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier
                                                </button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>

                </div>
            </section>


            <div class="separator">
                <span id="educatives" class="separator-text">Semaines éducatives</span>
            </div>

            <!-- SEMAINE EDUCATIVE -->
            <section class="cd-h-timeline" id="timeline-educatives">
                <div class="cd-h-timeline__container">
                    <div class="cd-h-timeline__dates">
                        <div class="cd-h-timeline__line">
                            <ol id="events-educatives">
                                {% for educative in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                                    {% if educative.categorie == 'Educative' %}
                                        <li>
                                            <a class="cd-h-timeline__date" href="#0"
                                               data-date="{{ educative.date|date("d/m/Y") }}T{{ educative.heure|date("h:m") }}">
                                                {{ educative.date|format_datetime(pattern="d MMM", locale='fr') }}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ol>
                            <span class="cd-h-timeline__filling-line" aria-hidden="true"></span>
                        </div>
                    </div>

                    <ul>
                        <li>
                            <a href="#0"
                               class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--prev cd-h-timeline__navigation--inactive">Prev</a>
                        </li>
                        <li>
                            <a href="#0" class="text-replace cd-h-timeline__navigation cd-h-timeline__navigation--next">Next</a>
                        </li>
                    </ul>

                    <a id="js-educative" class="new" data-toggle="modal" data-target="#rendezVousModal">
                        <span class="glyphicon glyphicon-plus"></span>
                    </a>
                </div>

                <div class="cd-h-timeline__events">
                    <ol id="events-content-educatives">
                        {% for educative in patient.rendezVous|sort((a, b) => b.date <=> a.date) %}
                            {% if educative.categorie == 'Educative' %}
                                <li class="cd-h-timeline__event"
                                    data-date="{{ educative.date|date("d/m/Y") }}T{{ educative.heure|date("h:m") }}"
                                    data-id="{{ educative.id }}">
                                    <h2 class="cd-h-timeline__event-title">Semaine éducative</h2>
                                    <em class="cd-h-timeline__event-date">
                                        {{ educative.date|format_datetime(pattern="d MMMM YYYY", locale='fr') }}
                                    </em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_date">Date
                                                        prévue</label>
                                                    <input disabled type="text"
                                                           id="patient_creation_form_educatives_{{ educative.id }}_date"
                                                           name="patient_creation_form[educative][{{ educative.id }}][date]"
                                                           required="required" class="datepicker form-control"
                                                           value="{{ educative.date|date("d/m/Y") }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_heure">Heure</label>
                                                    <select disabled type="text"
                                                            id="patient_creation_form_educatives_{{ educative.id }}_heure"
                                                            name="patient_creation_form[educative][{{ educative.id }}][heure]"
                                                            required="required" class="form-control heure">
                                                        <option value="{{ educative.slot }}"
                                                                selected>{{ educative.heure|date("H:i") }}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_educatives_{{ educative.id }}_accompagnant"
                                                            name="patient_creation_form[educative][{{ educative.id }}][accompagnant]"
                                                            class="form-control">
                                                        <option value="" {% if educative.accompagnant == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non" {% if educative.accompagnant == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui" {% if educative.accompagnant == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_etat">A-t-il
                                                        eu lieu ?</label>
                                                    <select id="patient_creation_form_educatives_{{ educative.id }}_etat"
                                                            name="patient_creation_form[educative][{{ educative.id }}][etat]"
                                                            class="form-control" style="background: gold;">
                                                        <option value=""
                                                                class="white" {% if educative.etat == '' %} selected="selected" {% endif %}></option>
                                                        <option value="Non"
                                                                class="gold" {% if educative.etat == 'Non' %} selected="selected" {% endif %}>
                                                            Non
                                                        </option>
                                                        <option value="Oui"
                                                                class="hotpink" {% if educative.etat == 'Oui' %} selected="selected" {% endif %}>
                                                            Oui
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_motifRefus">Motif
                                                        de refus</label>
                                                    <input type="text"
                                                           id="patient_creation_form_educatives_{{ educative.id }}_motifRefus"
                                                           name="patient_creation_form[educative][{{ educative.id }}][motifRefus]"
                                                           class="form-control" value="{{ educative.motifRefus }}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label"
                                                           for="patient_creation_form_educatives_{{ educative.id }}_notes">Notes
                                                        de transmission</label>
                                                    <textarea type="text"
                                                              id="patient_creation_form_educatives_{{ educative.id }}_notes"
                                                              name="patient_creation_form[educative][{{ educative.id }}][notes]"
                                                              class="form-control">{{ educative.notes }}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier
                                                </button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ol>

                </div>
            </section>


            <div class="separator"></div>
            <div class="row">
                <div class="col-md-12">
                    {{ form_row(form.offre, {'required': false}) }}
                </div>
            </div>


            <div class="separator">
                <span id="diagnosticEducatif" class="separator-text">Diagnostic éducatif</span>
            </div>
            <div class="form-inline">
                <a href="{{ path('patient_edit_diagnostic', {'id': patient.id }) }}"
                   class="btn btn-primary">Modifier</a>
                <a href="{{ path('patient_vue_diagnostic', {'id': patient.id }) }}" class="btn btn-primary">Voir</a>
            </div>


            <div class="separator"></div>
            <div class="form-inline">
                <a href="#" class="btn btn-default js-cd-back">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Retour
                </a>
                <a href="#0" class="btn btn-danger" data-toggle="modal" data-target="#supprModal">
                    <span class="glyphicon glyphicon-trash"></span>
                    Supprimer
                </a>
                {{ form_row(form.validation, {'attr': {'class': 'btn btn-primary'} }) }}
            </div>

            {{ form_row(form._token) }}
            {{ form_end(form, {'render_rest' : false}) }}
        </div>
        <!-- End content -->

        <!-- Modal supprPatient-->
        <div id="supprModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-warning"></span>
                            Suppression</h4>
                    </div>
                    <div class="modal-body">
                        <p>Êtes-vous sûr de vouloir supprimer ce patient ?</p>
                        <form method="post" action="{{ path('patient_delete', {'id': patient.id}) }}">
                            <input type="hidden" name="_method" value="DELETE">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ patient.id) }}">
                            <button class="btn btn-primary btn-block-md">Oui</button>
                            <button class="btn btn-danger btn-block-md" data-dismiss="modal">Non</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal addRendezVous-->
        <div id="rendezVousModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-plus"></span>
                            Ajouter une consultation
                        </h4>
                    </div>
                    <div class="modal-body">
                        <div class="error-msg"></div>
                        {{ form_start(formRendezVous) }}
                        {{ form_errors(formRendezVous) }}
                        <div class="row">
                            <div class="col-md-6">
                                {{ form_row(formRendezVous.date, {'attr': {'autocomplete': 'off'} }) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(formRendezVous.heure) }}
                            </div>
                        </div>
                        <div class="row js-hide">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label" for="rendez_vous_thematique">Thématique</label>
                                    <select type="text" id="rendez_vous_thematique" name="rendez_vous[thematique]"
                                            class="form-control thematique">
                                        <option value=""></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="control-label" for="rendez_vous_type">Type</label>
                                    <select type="text" id="rendez_vous_type" name="rendez_vous[type]"
                                            class="form-control type">
                                        <option value=""></option>
                                        <option value="Ambu">Ambu</option>
                                        <option value="Tel">Tel</option>
                                        <option value="Hospit">Hospit</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                {{ form_row(formRendezVous.accompagnant, {'required': false}) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_row(formRendezVous.etat, {'required': false}) }}
                            </div>
                        </div>
                        {{ form_row(formRendezVous.motifRefus, {'required': false}) }}
                        {{ form_row(formRendezVous.notes, {'required': false}) }}
                        {{ form_row(formRendezVous._token) }}
                        {{ form_end(formRendezVous, {'render_rest' : false}) }}
                        <button id="rendezVous_add" class="btn btn-primary btn-block" data-dismiss="modal">Ajouter
                        </button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Modal Suppression-->
        <div id="removeModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">
                            <span class="glyphicon glyphicon-warning"></span>
                            Suppression</h4>
                    </div>
                    <div class="modal-body">
                        <p>Êtes-vous sûr de vouloir supprimer cet élément ?</p>
                        <button class="btn btn-primary btn-block-md" data-dismiss="modal">Oui</button>
                        <button class="btn btn-danger btn-block-md" data-dismiss="modal">Non</button>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default pull-left" data-dismiss="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            Annuler
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <a id="timeline_update"></a>
    </div>
{% endblock page_content %}

{% block javascripts %}
    <script src="{{ asset('js/script.js') }}"></script>
    <script src="{{ asset('js/timeline/util.js') }}"></script>
    <script src="{{ asset('js/timeline/swipe-content.js') }}"></script>
    <script src="{{ asset('js/timeline/main.js') }}"></script>
    <script type="text/javascript">

        //TODO : add date on delete to 'datesConsultations' or ...

        const patientId = {{ patient.id }};

        var alert_pos = {{ top }};

        var datesConsultations = {{ dates_consultations|json_encode|raw }};
        var datesEntretiens = {{ dates_entretiens|json_encode|raw }};
        var datesAteliers = {{ dates_ateliers|json_encode|raw }};
        var datesEducatives = {{ dates_educatives|json_encode|raw }};
        var datesCoachings = {{ dates_coachings|json_encode|raw }};

        var dates;

        var thematiques = {{ thematiques|json_encode|raw }};

        $('.js-cd-back').on('click', function (e) {
            e.preventDefault();
            window.history.back();
        });

        $('.js-cd-save').on('click', function () {
            $('#patient_creation_form_validation').trigger('click');
        });

        // Utils
        function sortDate(a, b) {
            let attr1 = $(a).attr('data-date');
            if (typeof attr1 === typeof undefined || attr1 === false) {
                attr1 = $(a).find('a').attr('data-date');
            }
            let attr2 = $(b).attr('data-date');
            if (typeof attr2 === typeof undefined || attr2 === false) {
                attr2 = $(b).find('a').attr('data-date');
            }
            let date1 = moment(attr1, 'DD/MM/YYYYTh:mm');
            let date2 = moment(attr2, 'DD/MM/YYYYTh:mm');
            return (date1 > date2 ? 1 : -1);
        }

        function orderTimeline() {
            $('.cd-h-timeline').each(function () {
                let timeline = $(this).find('.cd-h-timeline__container ol');
                let events = $(this).find('.cd-h-timeline__events ol');
                timeline.find('li').sort(sortDate).appendTo(timeline);
                events.find('li').sort(sortDate).appendTo(events);
            });
        }

        function setNumberEvent() {
            $('.cd-h-timeline__events ol li.cd-h-timeline__event').each(function () {
                let index = $(this).index() + 1;
                let title = $(this).find('.cd-h-timeline__event-title').text();
                let arr = title.split(' ');
                if ($.isNumeric(arr[arr.length - 1]))
                    title = title.replace(' ' + arr[arr.length - 1], '');
                $(this).find('.cd-h-timeline__event-title').text(title + ' ' + index);
            });
        }

        /* On start */
        function updateForm() {
            updateEntretienDatepicker();
            updateConsultationDatepicker();
            updateAtelierDatepicker();
            updateEducativeDatepicker();
            updateCoachingDatepicker();

            orderTimeline();
            changeSelectColor(null);
            sortSelect();
            setNumberEvent();
        }

        updateForm();

        var timelineConsultations, timelineEntretiens, timelineAteliers, timelineEducative, timelineCoaching;
        $('.cd-h-timeline__cd-h-timeline__line li:last-child').addClass('cd-h-timeline__date');
        $('.cd-h-timeline__line li:not(:last-child) a').addClass('cd-h-timeline__event--older-event');
        $('.cd-h-timeline__line li:last-child a').addClass('cd-h-timeline__date--selected');

        function resetTimeline() {
            if ($('#events-consultations li').length) timelineConsultations = new HorizontalTimeline(document.getElementById('timeline-consultations'));
            if ($('#events-entretiens li').length) timelineEntretiens = new HorizontalTimeline(document.getElementById('timeline-entretiens'));
            if ($('#events-ateliers li').length) timelineAteliers = new HorizontalTimeline(document.getElementById('timeline-ateliers'));
            if ($('#events-educatives li').length) timelineEducative = new HorizontalTimeline(document.getElementById('timeline-educatives'));
            if ($('#events-coachings li').length) timelineCoaching = new HorizontalTimeline(document.getElementById('timeline-coachings'));
        }

        resetTimeline();


        {# Set select color #}
        function setSelectColor(obj) {
            let color = obj.find(":selected").attr("class");
            if (!color)
                return;
            obj.css({background: color});
            let index = obj.parents('li').index();
            let dot = obj.parents('.cd-h-timeline__events').prev().find('ol li:eq(' + index + ') a');

            if (dot.hasClass('cd-h-timeline__date--selected'))
                dot.removeClass().addClass('cd-h-timeline__date--selected');
            else if (dot.hasClass('cd-h-timeline__date--older-event'))
                dot.removeClass().addClass('cd-h-timeline__date--older-event');
            else
                dot.removeClass();
            dot.addClass('cd-h-timeline__date ' + color + '-after');
        }

        function changeSelectColor(obj) {
            if (obj)
                setSelectColor(obj)
            else {
                $('section select').each(function () {
                    setSelectColor($(this));
                });
            }
        }

        $('ol, .modal').on('change', 'select', function () {
            changeSelectColor($(this));
        });

        {# Update datetime #}
        function sort_li(a, b) {
            return ($(b).find("a").attr('data-date')) < ($(a).find("a").attr('data-date')) ? 1 : -1;
        }

        var month = ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
        $("ol").on("change", ".datepicker", function () {
            let datetime = $(this).val()
            if (datetime === '')
                return false;
            datetime = datetime.split("/");
            // $(this).parents("li").attr("data-date", $(this).val());
            $(this).parents("li").find("em").text(parseInt(datetime[0]) + " " + month[parseInt(datetime[1]) - 1] + " " + datetime[2]);
            let index = $(this).parents('li').index();
            let dot = $(this).parents('.cd-h-timeline__events').prev().find('ol li:eq(' + index + ') a');
            dot.attr('data-date', $(this).val());
            dot.text(parseInt(datetime[0]) + " " + month[parseInt(datetime[1]) - 1]);
        })

        {# Alert #}
        function errorAlert() {
            $('body').prepend(
                '<div class="row alert alert-danger text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Erreur !</div>'
            );
            alert_pos += 72;
        }

        function deleteAlert() {
            $('body').prepend(
                '<div class="row alert alert-success text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Suppression effectuée !</div>'
            );
            alert_pos += 72;
        }

        function editAlert() {
            $('body').prepend(
                '<div class="row alert alert-success text-center box-shadow" style="top:' + alert_pos + 'px;"><span class="closebtn" onclick="this.parentElement.style.display=\'none\';">&times;</span>Modification effectuée !</div>'
            );
            alert_pos += 72;
        }

        {# Delete #}
        $('.cd-h-timeline').on("click", ".btn-danger", function () {
            $("#removeModal").attr('data-id', $(this).closest('li').attr('data-id'));
            $("#removeModal").modal();
        });

        $('#removeModal .btn-primary').on('click', function () {
            let id = $('#removeModal').attr('data-id');
            let btn = $('.cd-h-timeline__events li[data-id="' + id + '"] .btn-danger');
            let num = btn.closest('li').index();
            let timeline = btn.parents('.cd-h-timeline');
            let date = btn.closest('li').find('.datepicker').val();

            if (btn.closest('ol').is('#events-content-consultations'))
                dates = datesConsultations;
            else if (btn.closest('ol').is('#events-content-entretiens'))
                dates = datesEntretiens;
            else if (btn.closest('ol').is('#events-content-ateliers'))
                dates = datesAteliers;
            else if (btn.closest('ol').is('#events-content-educatives'))
                dates = datesEducatives;
            else if (btn.closest('ol').is('#events-content-coachings'))
                dates = datesCoachings;

            let hasValue = hasValueDeep(dates, date);
            if (!hasValue)
                dates.push({'date': date, 'rendezVous': "0", 'place': 1});
            else {
                dates.forEach(function (e, v) {
                    if (e.date === date)
                        e.place = e.place + 1;
                });
            }

            timeline.find('ol').each(function () {
                $(this).find('li:nth-child(' + (num + 1) + ')').remove();
            });
            timeline.find('.cd-h-timeline__line li a').removeClass("cd-h-timeline__date--selected").addClass("cd-h-timeline__date--older-event");
            timeline.find('.cd-h-timeline__line li:last-child a').removeClass("cd-h-timeline__date--older-event").addClass("cd-h-timeline__date--selected");
            timeline.find('.cd-h-timeline__timeline__events li').removeClass("cd-h-timeline__event--selected");
            timeline.find('.cd-h-timeline__timeline__events li:last-child').addClass("cd-h-timeline__event--selected");
            resetTimeline();

            let url = "{{ path( 'rendezVous_remove', { 'id': 'rendezVous_id' }) }}";
            url = url.replace("rendezVous_id", id);
            $.ajax({
                url: url, type: "DELETE", success: function () {
                    deleteAlert()
                }
            });

        });


        {# Global request #}
        function getHours(date, type) {
            return $.ajax({
                url: "{{ path('slot_get_hours') }}",
                type: "POST",
                dataType: "json",
                data: {
                    date: date,
                    type: type
                },
                success: function (res) {
                    if (res) return res;
                    else errorAlert();
                }
            });
        }

        function getThematiqueType(id) {
            return $.ajax({
                url: "{{ path('slot_get_thematique_type') }}",
                type: "POST",
                dataType: "json",
                data: {
                    id: id
                },
                success: function (res) {
                    if (res) return res;
                    else errorAlert();
                }
            });
        }

        function setThematiqueType(el) {
            if (el.val() === '')
                return false;
            let row = el.closest('.row').next();
            row.find('.thematique').val('');
            row.find('.type').val('');
            $.when(getThematiqueType(el.val()).done(function (res) {
                if (res.length > 0) {
                    row.find('.thematique').val(res[0]['thematique']);
                    row.find('.type').val(res[0]['type']);
                }
            }));
        }

        $('.heure').change(function () {
            setThematiqueType($(this));
        });

        {# Add RendezVous #}
        $('#rendezVousModal').on('show.bs.modal', function () {
            $('#rendezVousModal .error-msg').hide();
            $(this).find('form[name="rendez_vous"]')[0].reset();
            let index = 0
            $('#rendezVousModal .modal-header h4').text('Ajouter une consultation');
            if (categorie === 'Entretien') {
                index = 1;
                $('#rendezVousModal .modal-header h4').text('Ajouter un entretien');
            } else if (categorie === 'Atelier') {
                index = 2;
                $('#rendezVousModal .modal-header h4').text('Ajouter un atelier');
            } else if (categorie === 'Coaching') {
                index = 3;
                $('#rendezVousModal .modal-header h4').text('Ajouter un coaching PRM');
            } else if (categorie === 'Educative') {
                index = 4;
                $('#rendezVousModal .modal-header h4').text('Ajouter une semaine éducative');
            }
            $('#rendez_vous_date').datepicker('update', '');
            $('#rendez_vous_heure option').remove();
            $('#rendez_vous_thematique option:not(:first)').remove();
            $.each(thematiques[index], function (key, value) {
                $('#rendez_vous_thematique')
                    .append($("<option></option>")
                        .attr("value", value)
                        .text(value));
            });
            if (categorie === 'Educative') {
                $('.js-hide').hide();
            } else {
                $('.js-hide').show();
            }
        })

        var categorie = 'Consultation';
        $("#rendezVous_add").on('click', function () {
            let c = categorie.toLowerCase();
            let date = $('#rendez_vous_date').val();
            let slotId = $('#rendez_vous_heure').val();
            let time = $('#rendez_vous_heure option:selected').text()
            let thematique = $('#rendez_vous_thematique').val();
            let type = $('#rendez_vous_type').val();
            let accompagnant = $('#rendez_vous_accompagnant').val();
            let etat = $('#rendez_vous_etat').val();
            let motifRefus = $('#rendez_vous_motifRefus').val();
            let notes = $('#rendez_vous_notes').val();

            if (date === '') {
                $('#rendezVousModal .error-msg').text('Erreur : aucun jour sélectionné')
                $('#rendezVousModal .error-msg').show();
                return false;
            } else if (time === '') {
                $('#rendezVousModal .error-msg').text('Erreur : aucune horaire renseignée')
                $('#rendezVousModal .error-msg').show();
                return false;
            } else {
                $('#rendezVousModal .error-msg').hide();
            }

            $.ajax({
                url: "{{ path('rendezVous_add') }}",
                type: "POST",
                dataType: "json",
                data: {
                    "id": '{{ patient.id }}',
                    "slotId": slotId,
                    "date": date,
                    "time": time,
                    "thematique": thematique,
                    "type": type,
                    "accompagnant": accompagnant,
                    "etat": etat,
                    "motifRefus": motifRefus,
                    "notes": notes,
                    "patientId": patientId,
                    "categorie": categorie,
                },
                success: function (res) {
                    if (res) {
                        if (categorie === 'Consultation')
                            dates = datesConsultations;
                        else if (categorie === 'Entretien')
                            dates = datesEntretiens;
                        else if (categorie === 'Atelier')
                            dates = datesAteliers;
                        else if (categorie === 'Educative')
                            dates = datesEducatives;
                        else if (categorie === 'Coaching')
                            dates = datesCoachings;

                        dates.forEach(function (e, v) {
                            if (e['date'] === date)
                                e.place = e.place - 1;
                        });

                        let new_date = new Date(formatDate(date));
                        let date_h1 = new Intl.DateTimeFormat("fr-FR", {
                            month: 'short',
                            day: 'numeric'
                        }).format(new_date);
                        let date_em = new Intl.DateTimeFormat("fr-FR", {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        }).format(new_date);
                        let nb = $("#events-content-" + c + "s").find('li').length;

                        let events = $('#events-' + c + 's');
                        $('#events-' + c + 's li a').removeClass("cd-h-timeline__date--selected");
                        $('#events-' + c + 's li a').addClass("cd-h-timeline__date--older-event");
                        $(document.createElement('li'))
                            .append('<a class="cd-h-timeline__date" href=\"#0\" data-date=' + date + 'T' + time + '>' + date_h1 + '</a>')
                            .appendTo(events);
                        $('#events-' + c + 's li:last-child a').removeClass('cd-h-timeline__date--older-event');
                        $('#events-' + c + 's li:last-child a').addClass('cd-h-timeline__date--selected');

                        let index = 0
                        if (categorie === 'Entretien')
                            index = 1;
                        else if (categorie === 'Atelier')
                            index = 2;
                        else if (categorie === 'Coaching')
                            index = 3;
                        let options;
                        $.each(thematiques[index], function (key, value) {
                            options += '<option value="' + value + '">' + value + '</option>'
                        });

                        let title = categorie;
                        if (categorie === 'Educative')
                            title = "Semaine éducative";
                        else if (categorie === 'Coaching')
                            title = "Coaching PRM";

                        let events_content = $('#events-content-' + c + 's');
                        $('#events-content-' + c + 's li').removeClass("cd-h-timeline__event--selected");
                        $(events_content)
                            .append(`
                                <li class="cd-h-timeline__event" data-date="` + date + `T` + time + `" data-id="` + res + `">
                                    <h2 class="cd-h-timeline__event-title">` + title + `</h2>
                                    <em class="cd-h-timeline__event-date">` + date_em + `</em>
                                    <div>
                                        <div class="error-msg"></div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required" for="patient_creation_form_` + c + `s_` + res + `_date">Date prévue</label>
                                                    <input disabled type="text" id="patient_creation_form_` + c + `s_` + res + `_date" name="patient_creation_form[` + c + `][` + res + `][date]" required="required" class="datepicker form-control" value="` + date + `">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label required" for="patient_creation_form_` + c + `s_` + res + `_heure">Heure</label>
                                                    <select disabled type="text" id="patient_creation_form_` + c + `s_` + res + `_heure" name="patient_creation_form[` + c + `][` + res + `][heure]" required="required" class="form-control heure">
                                                        <option value="` + slotId + `" selected="selected">` + time + `</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row js-delete">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_thematique">
                                                        Thématique
                                                    </label>
                                                    <select type="text" id="patient_creation_form_` + c + `s_` + res + `_thematique" name="patient_creation_form[` + c + `][` + res + `][thematique]" class="form-control thematique" value="` + thematique + `">
                                                        <option value=''></option>
                                                        ` + options + `
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_type">
                                                        Type
                                                    </label>
                                                    <select type="text" id="patient_creation_form_` + c + `s_` + res + `_type" name="patient_creation_form[` + c + `][` + res + `][type]" class="form-control type">
                                                        <option value=""></option>
                                                        <option value="Ambu">Ambu</option>
                                                        <option value="Tel">Tel</option>
                                                        <option value="Hospit">Hospit</option>
                                                    <select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_accompagnant">Accompagnant</label>
                                                    <select id="patient_creation_form_` + c + `s_` + res + `_accompagnant" name="patient_creation_form[` + c + `][` + res + `][accompagnant]" class="form-control">
                                                        <option value=""></option>
                                                        <option value="Non">Non</option>
                                                        <option value="Oui">Oui</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_etat">A-t-il eu lieu ?</label>
                                                    <select id="patient_creation_form_` + c + `s_` + res + `_etat" name="patient_creation_form[` + c + `][` + res + `][etat]" class="form-control">
                                                        <option value="" class="white"></option>
                                                        <option value="Non" class="gold">Non</option>
                                                        <option value="Oui" class="hotpink">Oui</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_motifRefus">Motif de refus</label>
                                                    <input type="text" id="patient_creation_form_` + c + `s_` + res + `_motifRefus" name="patient_creation_form[` + c + `][` + res + `][motifRefus]" class="form-control" value="` + motifRefus + `">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label" for="patient_creation_form_` + c + `s_` + res + `_notes">Notes de transmission</label>
                                                    <textarea type="text" id="patient_creation_form_` + c + `s_` + res + `_notes" name="patient_creation_form[` + c + `][` + res + `][notes]" class="form-control">` + notes + `</textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-primary pull-right">Modifier</button>
                                                <button type="button" class="btn btn-danger pull-left">Supprimer</button>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            `)
                            .appendTo(events_content);
                        $('#patient_creation_form_' + c + 's_' + res + '_thematique').val(thematique);
                        $('#patient_creation_form_' + c + 's_' + res + '_type').val(type);
                        $('#patient_creation_form_' + c + 's_' + res + '_accompagnant').val(accompagnant);
                        $('#patient_creation_form_' + c + 's_' + res + '_etat').val(etat);
                        $('#events-content-' + c + 's li:last-child').addClass('cd-h-timeline__event--selected');

                        $('form[name="rendez_vous"]')[0].reset();
                        $('form[name="rendez_vous"] #rendez_vous_etat').css({'background': 'white'});

                        if (categorie === 'Educative')
                            $('.js-delete').remove();
                        updateForm();
                        resetTimeline();
                    } else {
                        errorAlert();
                    }
                }
            });
        });

        {# Edit RendezVous #}
        $("#events-content-consultations, #events-content-entretiens, #events-content-ateliers, #events-content-educatives, #events-content-coachings").on("click", ".btn-primary", function () {
            let c = 'consultations';
            if ($(this).closest('ol').is('#events-content-entretiens'))
                c = 'entretiens';
            else if ($(this).closest('ol').is('#events-content-ateliers'))
                c = 'ateliers';
            else if ($(this).closest('ol').is('#events-content-educatives'))
                c = 'educatives';
            else if ($(this).closest('ol').is('#events-content-coachings'))
                c = 'coachings';
            let li = $(this).closest("li");
            let id = li.find('input').attr('id').match(/\d+/)[0];
            let slotId = li.find('#patient_creation_form_' + c + '_' + id + '_heure').val();
            let date = li.find('#patient_creation_form_' + c + '_' + id + '_date').val();
            let time = li.find('#patient_creation_form_' + c + '_' + id + '_heure option:selected').text()
            let thematique = li.find('#patient_creation_form_' + c + '_' + id + '_thematique').val();
            let type = li.find('#patient_creation_form_' + c + '_' + id + '_type').val();
            let accompagnant = li.find('#patient_creation_form_' + c + '_' + id + '_accompagnant').val();
            let etat = li.find('#patient_creation_form_' + c + '_' + id + '_etat').val();
            let motifRefus = li.find('#patient_creation_form_' + c + '_' + id + '_motifRefus').val();
            let notes = li.find('#patient_creation_form_' + c + '_' + id + '_notes').val();

            let url = "{{ path('rendezVous_patch', { 'id': 'rendezVous_id' }) }}";
            url = url.replace("rendezVous_id", id);

            if (date === '') {
                li.find('.error-msg').text('Erreur : aucun jour sélectionné')
                li.find('.error-msg').show();
                return false;
            } else if (time === '') {
                li.find('.error-msg').text('Erreur : aucune horaire renseignée')
                li.find('.error-msg').show();
                return false;
            } else {
                li.find('.error-msg').hide();
            }

            $.ajax({
                url: url,
                type: "POST",
                dataType: "json",
                data: {
                    "slotId": slotId,
                    "date": date,
                    "time": time,
                    "thematique": thematique,
                    "type": type,
                    "accompagnant": accompagnant,
                    "etat": etat,
                    "motifRefus": motifRefus,
                    "notes": notes,
                    "patientId": patientId,
                },
                success: function () {
                    editAlert();
                },
                error: function () {
                    errorAlert();
                }
            });
        })


        {# rendezVous datepicker #}
        function updateRendezVousDatepicker() {
            if (categorie === 'Consultation')
                dates = datesConsultations;
            else if (categorie === 'Entretien')
                dates = datesEntretiens;
            else if (categorie === 'Atelier')
                dates = datesAteliers;
            else if (categorie === 'Educative')
                dates = datesEducatives;
            else if (categorie === 'Coaching')
                dates = datesCoachings;
            $('#rendez_vous_date').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true, updateViewDate: false,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (dates && dates.length > 0) {
                        for (let i = 0; i < dates.length; i++) {
                            if (day === moment(dates[i]['date'], 'DD/MM/YYYY').unix()
                                && dates[i]['place'] - dates[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                }
            });
            $('#rendez_vous_date').datepicker('update');
        }


        $('#rendez_vous_date').on('changeDate', function (e) {
            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), categorie)).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        /* Consultations
		============================================================================== */

        function updateConsultationDatepicker() {
            $('#timeline-consultations .datepicker').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (datesConsultations.length > 0) {
                        for (let i = 0; i < datesConsultations.length; i++) {
                            if (day === moment(datesConsultations[i]['date'], 'DD/MM/YYYY').unix()
                                && datesConsultations[i]['place'] - datesConsultations[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                }
            });
            $('#timeline-consultations .datepicker').datepicker('update');
        };

        $('#timeline-consultations').on('focusin', '.datepicker', function (e) {
            $(this).attr('data-old', $(this).val());
        });

        $('#timeline-consultations').on('changeDate', '.datepicker', function (e) {
            let hasValue = hasValueDeep(datesConsultations, $(this).attr('data-old'));
            if (!hasValue)
                datesConsultations.push({'date': $(this).attr('data-old')});
            updateConsultationDatepicker();

            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), 'Consultation')).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        {# Add #}
        $('#js-consultation').click(function () {
            categorie = 'Consultation';
            $('#rendezVousModal').attr('data-categorie', 'consultation');
            updateRendezVousDatepicker();
        })


        /* Entretiens
		============================================================================== */

        function updateEntretienDatepicker() {
            $('#timeline-entretiens .datepicker').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (datesEntretiens.length > 0) {
                        for (let i = 0; i < datesEntretiens.length; i++) {
                            if (day === moment(datesEntretiens[i]['date'], 'DD/MM/YYYY').unix()
                                && datesEntretiens[i]['place'] - datesEntretiens[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                }
            });
            $('#timeline-entretiens .datepicker').datepicker('update');
        };

        $('#timeline-entretiens').on('focusin', '.datepicker', function (e) {
            $(this).attr('data-old', $(this).val());
        });

        $('#timeline-entretiens').on('changeDate', '.datepicker', function (e) {
            let hasValue = hasValueDeep(datesEntretiens, $(this).attr('data-old'));
            if (!hasValue)
                datesEntretiens.push({'date': $(this).attr('data-old')});
            updateEntretienDatepicker();

            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), 'Entretien')).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        {# Add #}
        $('#js-entretien').click(function () {
            categorie = 'Entretien';
            $('#rendezVousModal').attr('data-categorie', 'entretien');
            updateRendezVousDatepicker();
        })


        /* Ateliers
	    ============================================================================== */

        function updateAtelierDatepicker() {
            $('#timeline-ateliers .datepicker').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (datesAteliers.length > 0) {
                        for (let i = 0; i < datesAteliers.length; i++) {
                            if (day === moment(datesAteliers[i]['date'], 'DD/MM/YYYY').unix()
                                && datesAteliers[i]['place'] - datesAteliers[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                },
            });
            $('#timeline-ateliers .datepicker').datepicker('update');
        };

        $('#timeline-ateliers').on('focusin', '.datepicker', function (e) {
            $(this).attr('data-old', $(this).val());
        });

        $('#timeline-ateliers').on('changeDate', '.datepicker', function (e) {
            let hasValue = hasValueDeep(datesAteliers, $(this).attr('data-old'));
            if (!hasValue)
                datesAteliers.push({'date': $(this).attr('data-old')});
            updateAtelierDatepicker();

            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), 'Atelier')).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        {# Add #}
        $('#js-atelier').click(function () {
            categorie = 'Atelier';
            $('#rendezVousModal').attr('data-categorie', 'atelier');
            updateRendezVousDatepicker();
        })


        /* Semaine educative
	    ============================================================================== */

        function updateEducativeDatepicker() {
            $('#timeline-educatives .datepicker').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (datesEducatives.length > 0) {
                        for (let i = 0; i < datesEducatives.length; i++) {
                            if (day === moment(datesEducatives[i]['date'], 'DD/MM/YYYY').unix()
                                && datesEducatives[i]['place'] - datesEducatives[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                },
            });
            $('#timeline-educatives .datepicker').datepicker('update');
        };

        $('#timeline-educatives').on('focusin', '.datepicker', function (e) {
            $(this).attr('data-old', $(this).val());
        });

        $('#timeline-educatives').on('changeDate', '.datepicker', function (e) {
            let hasValue = hasValueDeep(datesEducatives, $(this).attr('data-old'));
            if (!hasValue)
                datesEducatives.push({'date': $(this).attr('data-old')});
            updateEducativeDatepicker();

            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), 'Educative')).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        {# Add #}
        $('#js-educative').click(function () {
            categorie = 'Educative';
            $('#rendezVousModal').attr('data-categorie', 'educative');
            updateRendezVousDatepicker();
        })


        /* Coaching PRM
	    ============================================================================== */

        function updateCoachingDatepicker() {
            $('#timeline-coachings .datepicker').datepicker({
                language: 'fr', format: 'dd/mm/yyyy', todayBtn: true, autoclose: true,
                beforeShowDay: function (currentDate) {
                    let day = moment(currentDate).unix();
                    if (datesCoachings.length > 0) {
                        for (let i = 0; i < datesCoachings.length; i++) {
                            if (day === moment(datesCoachings[i]['date'], 'DD/MM/YYYY').unix()
                                && datesCoachings[i]['place'] - datesCoachings[i]['rendezVous'] > 0) {
                                return {classes: 'highlight'};
                            }
                        }
                    }
                    return false;
                },
            });
            $('#timeline-coachings .datepicker').datepicker('update');
        };

        $('#timeline-coachings').on('focusin', '.datepicker', function (e) {
            $(this).attr('data-old', $(this).val());
        });

        $('#timeline-coachings').on('changeDate', '.datepicker', function (e) {
            let hasValue = hasValueDeep(datesCoachings, $(this).attr('data-old'));
            if (!hasValue)
                datesCoachings.push({'date': $(this).attr('data-old')});
            updateCoachingDatepicker();

            let hourInput = $(this).closest('.row').find('.heure');
            hourInput.prop("disabled", false);
            hourInput.find('option').remove().end();
            $(this).closest('.row').next().find('.thematique').val('');
            $(this).closest('.row').next().find('.type').val('');
            $.when(getHours($(this).val(), 'Coaching')).done(function (res) {
                // hourInput.append(new Option('', ''));
                res.forEach(function (el) {
                    hourInput.append(new Option(el['hour'], el['id']));
                });
                setThematiqueType(hourInput);
            });
        });

        {# Add #}
        $('#js-coaching').click(function () {
            categorie = 'Coaching';
            $('#rendezVousModal').attr('data-categorie', 'coaching');
            updateRendezVousDatepicker();
        })


        /* 
	    ============================================================================== */

        function formatDate(input) {
            let datePart = input.match(/\d+/g),
                year = datePart[2], //.substring(2),  get only two digits
                month = datePart[1],
                day = datePart[0];
            return year + '-' + month + '-' + day;
        }

        function resetErrors() {
            $('input, select').removeClass('is-invalid');
            $(".invalid-feedback").remove();
        }

        function sortSelect() {
            $('.container-fluid').find('select').each(function () {
                let sel = $(this);
                let selected = sel.val();
                let opts_list = sel.find('option');
                opts_list.sort(function (a, b) {
                    return $(a).text() > $(b).text() ? 1 : -1;
                });
                sel.html('').append(opts_list);
                sel.val(selected);
            });
        }

        function hasValueDeep(json, findValue) {
            const values = Object.values(json);
            let hasValue = values.includes(findValue);
            values.forEach(function (value) {
                if (typeof value === "object") {
                    hasValue = hasValue || hasValueDeep(value, findValue);
                }
            })
            return hasValue;
        }

    </script>



    {# function reload_js(src) {
       	$('script[src="' + src + '"]').remove();
       	$('<script>').attr('src', src).appendTo('body');
   	} #}

    {# $.getScript("{{ asset('js/timeline.js') }}"); #}
    {# $(this).closest('tr').remove(); #}
    {# $('section#timeline-entretiens').load(location.href + ' #timeline-entretiens'); #}

{% endblock %}